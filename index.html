<!DOCTYPE html>
<html lang="ru">
<head>
Â  Â  <title>Seller Alert</title>
Â  Â  <meta charset="utf-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
Â  Â  <script src="https://telegram.org/js/telegram-web-app.js"></script>
Â  Â Â 
Â  Â  <style>
Â  Â  Â  Â  /* --- Ğ¡Ğ¢Ğ˜Ğ›Ğ˜ (CSS) --- */
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  background: #f0f2f5;
Â  Â  Â  Â  Â  Â  color: #1c1c1e;
Â  Â  Â  Â  Â  Â  -webkit-tap-highlight-color: transparent;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Ğ¥ĞµĞ´ĞµÑ€ (Ğ¸Ğ¼Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ñ) */
Â  Â  Â  Â  .tg-header {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #e0e0e0;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  color: #007aff;
Â  Â  Â  Â  }
Â  Â  Â  Â  .tg-header-title { color: #1c1c1e; font-weight: 600; display: flex; flex-direction: column; line-height: 1.2; }
Â  Â  Â  Â  .tg-header-title small { font-size: 12px; color: #6a6a6a; font-weight: 400; }
Â  Â  Â  Â  .tg-header .dots { font-size: 20px; cursor: pointer; }

Â  Â  Â  Â  .content-area { padding: 0 15px 20px; }

Â  Â  Â  Â  /* ĞŸÑ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ */
Â  Â  Â  Â  .welcome-section { padding: 20px 0; border-bottom: 1px solid #e0e0e0; margin-bottom: 20px; }
Â  Â  Â  Â  .logo { font-size: 28px; font-weight: 700; margin-bottom: 5px; }
Â  Â  Â  Â  .logo span { color: #ff5757; }
Â  Â  Â  Â  .welcome-text { font-size: 20px; font-weight: 500; margin: 0 0 20px; }

Â  Â  Â  Â  /* Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¸ ĞšĞ½Ğ¾Ğ¿ĞºĞ° "+" */
Â  Â  Â  Â  .account-status { display: flex; align-items: center; gap: 10px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .add-button {
Â  Â  Â  Â  Â  Â  width: 50px; height: 50px; border-radius: 50%;
Â  Â  Â  Â  Â  Â  background: #007aff; color: white;
Â  Â  Â  Â  Â  Â  font-size: 30px; line-height: 50px; text-align: center;
Â  Â  Â  Â  Â  Â  font-weight: 300; cursor: pointer;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 5px rgba(0, 122, 255, 0.3);
Â  Â  Â  Â  Â  Â  flex-shrink: 0;
Â  Â  Â  Â  Â  Â  transition: transform 0.1s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .add-button:active { transform: scale(0.95); }

Â  Â  Â  Â  .account-pill {
Â  Â  Â  Â  Â  Â  flex-grow: 1; padding: 10px 20px; background: #e9e9eb;
Â  Â  Â  Â  Â  Â  border-radius: 25px; text-align: center;
Â  Â  Â  Â  Â  Â  box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â  .account-pill-name {
Â  Â  Â  Â  Â  Â  font-size: 16px; margin: 0; font-weight: 600;
Â  Â  Â  Â  Â  Â  background-color: black; color: black; border-radius: 4px;
Â  Â  Â  Â  Â  Â  height: 18px; width: 80%; margin: 0 auto 2px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .account-pill-status { font-size: 14px; color: #3c3c43; margin: 0; font-weight: 500; }

Â  Â  Â  Â  /* Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° */
Â  Â  Â  Â  .stats-section { opacity: 0.5; transition: opacity 0.3s; pointer-events: none; }
Â  Â  Â  Â  .stats-section.active { opacity: 1; pointer-events: all; }

Â  Â  Â  Â  .stats-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 15px; }
Â  Â  Â  Â  .stats-header h2 { font-size: 26px; font-weight: 700; margin: 0; }
Â  Â  Â  Â  .stats-header .update-time { font-size: 14px; color: #6a6a6a; font-weight: 400; margin-top: 5px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .stats-grid { display: flex; gap: 10px; justify-content: space-between; }
Â  Â  Â  Â  .stat-card {
Â  Â  Â  Â  Â  Â  background: white; padding: 10px; border-radius: 12px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  Â  Â  width: calc(33.33% - 7px); box-sizing: border-box; text-align: left; overflow: hidden;
Â  Â  Â  Â  }
Â  Â  Â  Â  .stat-card h4 { font-size: 14px; color: #6a6a6a; margin: 0 0 5px; font-weight: 500; }
Â  Â  Â  Â  .stat-value { font-size: 18px; font-weight: 700; margin: 0 0 10px; color: #1c1c1e; line-height: 1.1; word-wrap: break-word; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .change-pill { width: 100%; padding: 8px 0; text-align: center; font-size: 14px; font-weight: 600; color: white; margin: 0 -10px -10px; }
Â  Â  Â  Â  .change-pill.red { background: #ff3b30; }
Â  Â  Â  Â  .change-pill.green { background: #34c759; }
Â  Â  Â  Â  .change-pill.light-green { background: #6cc644; }
Â  Â  Â  Â  .change-pill.neutral { background: #8e8e93; }

Â  Â  Â  Â  /* --- ĞœĞĞ”ĞĞ›Ğ¬ĞĞĞ• ĞĞšĞĞ Ğ”Ğ›Ğ¯ Ğ’Ğ’ĞĞ”Ğ Ğ¢ĞĞšĞ•ĞĞ --- */
Â  Â  Â  Â  .modal-overlay {
Â  Â  Â  Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.5); z-index: 100;
Â  Â  Â  Â  Â  Â  display: none; align-items: center; justify-content: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal {
Â  Â  Â  Â  Â  Â  background: white; width: 85%; max-width: 320px;
Â  Â  Â  Â  Â  Â  border-radius: 14px; padding: 20px;
Â  Â  Â  Â  Â  Â  text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal h3 { margin: 0 0 10px; }
Â  Â  Â  Â  .modal input {
Â  Â  Â  Â  Â  Â  width: 100%; padding: 10px; margin: 10px 0;
Â  Â  Â  Â  Â  Â  border: 1px solid #ccc; border-radius: 8px; font-size: 16px;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal-buttons { display: flex; gap: 10px; margin-top: 10px; }
Â  Â  Â  Â  .btn { flex: 1; padding: 10px; border-radius: 8px; font-size: 16px; border: none; cursor: pointer; }
Â  Â  Â  Â  .btn-cancel { background: #e9e9eb; color: #000; }
Â  Â  Â  Â  .btn-save { background: #007aff; color: white; font-weight: 600; }

Â  Â  Â  Â  /* Ğ¡Ğ¿Ğ¸Ğ½Ğ½ĞµÑ€ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ */
Â  Â  Â  Â  .loader { border: 3px solid #f3f3f3; border-top: 3px solid #007aff; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; }
Â  Â  Â  Â  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

Â  Â  Â  Â  /* Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ */
Â  Â  Â  Â  .notification {
Â  Â  Â  Â  Â  Â  position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
Â  Â  Â  Â  Â  Â  background: #ff3b30; color: white; padding: 10px 20px;
Â  Â  Â  Â  Â  Â  border-radius: 10px; z-index: 1000; display: none;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

Â  Â  <div class="tg-header">
Â  Â  Â  Â  <span onclick="Telegram.WebApp.close()">Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ</span>
Â  Â  Â  Â  <div class="tg-header-title">Seller Alert<small>Ğ¼Ğ¸Ğ½Ğ¸-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ</small></div>
Â  Â  Â  Â  <span class="dots">&#8942;</span>
Â  Â  </div>
Â  Â Â 
Â  Â  <div class="content-area">
Â  Â  Â  Â  <div class="welcome-section">
Â  Â  Â  Â  Â  Â  <div class="logo">seller<span>:</span>alert</div>
Â  Â  Â  Â  Â  Â  <p class="welcome-text" id="greeting">ĞŸÑ€Ğ¸Ğ²ĞµÑ‚!</p>

Â  Â  Â  Â  Â  Â  <div class="account-status">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="add-button" onclick="openTokenModal()">+</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="account-pill">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="account-pill-name" id="shop-name-hidden"></div>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="account-pill-status" id="status-text">ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ + Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ WB</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="stats-section" id="stats-section">
Â  Â  Â  Â  Â  Â  <div class="stats-header">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2>Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="update-time" id="last-updated">ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚Ğµ API Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="stats-grid">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4>Ğ”Ğ¾Ñ…Ğ¾Ğ´</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="stat-value" id="val-income">0â‚½</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="change-pill neutral" id="pill-income">+0â‚½</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4>CTR</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="stat-value" id="val-ctr">0%</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="change-pill neutral" id="pill-ctr">0%</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4>Ğ”Ğ Ğ </h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="stat-value" id="val-drr">0%</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="change-pill neutral" id="pill-drr">0%</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div class="modal-overlay" id="tokenModal">
Â  Â  Â  Â  <div class="modal">
Â  Â  Â  Â  Â  Â  <h3>ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ WB</h3>
Â  Â  Â  Â  Â  Â  <p style="font-size:13px; color:#666;">Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ API Ñ‚Ğ¾ĞºĞµĞ½ (Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° + ĞšĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚)</p>
Â  Â  Â  Â  Â  Â  <input type="text" id="apiTokenInput" placeholder="Ğ¢Ğ¾ĞºĞµĞ½ Ğ·Ğ´ĞµÑÑŒ...">
Â  Â  Â  Â  Â  Â  <div class="modal-buttons">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-cancel" onclick="closeTokenModal()">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn btn-save" onclick="connectToWB()">ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div class="notification" id="notification"></div>

Â  Â  <script>
Â  Â  Â  Â  // 1. Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Telegram Web App
Â  Â  Â  Â  const tg = window.Telegram.WebApp;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¸ Ñ€Ğ°ÑĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ½Ğ° Ğ²ĞµÑÑŒ ÑĞºÑ€Ğ°Ğ½
Â  Â  Â  Â  tg.ready();
Â  Â  Â  Â  tg.expand();
Â  Â  Â  Â  tg.enableClosingConfirmation();

Â  Â  Â  Â  // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¸Ğ¼ĞµĞ½Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
Â  Â  Â  Â  function getUserName() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ± 1: Ğ§ĞµÑ€ĞµĞ· initDataUnsafe
Â  Â  Â  Â  Â  Â  Â  Â  if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const user = tg.initDataUnsafe.user;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (user.first_name) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return user.first_name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (user.username) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return user.username;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ± 2: Ğ§ĞµÑ€ĞµĞ· initData ÑÑ‚Ñ€Ğ¾ĞºÑƒ (Ğ±Ğ¾Ğ»ĞµĞµ Ğ½Ğ°Ğ´ĞµĞ¶Ğ½Ñ‹Ğ¹)
Â  Â  Â  Â  Â  Â  Â  Â  const initData = tg.initData;
Â  Â  Â  Â  Â  Â  Â  Â  if (initData) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const params = new URLSearchParams(initData);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userParam = params.get('user');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (userParam) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const user = JSON.parse(decodeURIComponent(userParam));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (user.first_name) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return user.first_name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ± 3: Ğ•ÑĞ»Ğ¸ Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚
Â  Â  Â  Â  Â  Â  Â  Â  return 'Ğ´Ñ€ÑƒĞ³';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.log('Error getting username:', error);
Â  Â  Â  Â  Â  Â  Â  Â  return 'Ğ´Ñ€ÑƒĞ³';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', function() {
Â  Â  Â  Â  Â  Â  const userName = getUserName();
Â  Â  Â  Â  Â  Â  document.getElementById('greeting').textContent = `ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, ${userName}!`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Ğ›Ğ¾Ğ³Ğ¸ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸
Â  Â  Â  Â  Â  Â  console.log('Telegram WebApp:', tg);
Â  Â  Â  Â  Â  Â  console.log('InitDataUnsafe:', tg.initDataUnsafe);
Â  Â  Â  Â  Â  Â  console.log('InitData:', tg.initData);
Â  Â  Â  Â  Â  Â  console.log('User name:', userName);
Â  Â  Â  Â  });

Â  Â  Â  Â  // --- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼ Ğ¾ĞºĞ½Ğ¾Ğ¼ ---
Â  Â  Â  Â  const modal = document.getElementById('tokenModal');
Â  Â  Â  Â  const tokenInput = document.getElementById('apiTokenInput');

Â  Â  Â  Â  function openTokenModal() {
Â  Â  Â  Â  Â  Â  modal.style.display = 'flex';
Â  Â  Â  Â  Â  Â  tokenInput.focus();
Â  Â  Â  Â  }

Â  Â  Â  Â  function closeTokenModal() {
Â  Â  Â  Â  Â  Â  modal.style.display = 'none';
Â  Â  Â  Â  Â  Â  tokenInput.value = '';
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸ÑĞ¼Ğ¸ ---
Â  Â  Â  Â  function showNotification(message, isError = false) {
Â  Â  Â  Â  Â  Â  const notification = document.getElementById('notification');
Â  Â  Â  Â  Â  Â  notification.textContent = message;
Â  Â  Â  Â  Â  Â  notification.style.background = isError ? '#ff3b30' : '#34c759';
Â  Â  Â  Â  Â  Â  notification.style.display = 'block';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  notification.style.display = 'none';
Â  Â  Â  Â  Â  Â  }, 3000);
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- ĞŸĞĞ”ĞšĞ›Ğ®Ğ§Ğ•ĞĞ˜Ğ• Ğš WB API ---
Â  Â  Â  Â  async function connectToWB() {
Â  Â  Â  Â  Â  Â  const token = tokenInput.value.trim();
Â  Â  Â  Â  Â  Â  if (!token) {
Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ API Ñ‚Ğ¾ĞºĞµĞ½', true);
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  closeTokenModal();

Â  Â  Â  Â  Â  Â  // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
Â  Â  Â  Â  Â  Â  document.getElementById('status-text').innerHTML = '<span class="loader"></span> Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...';
Â  Â  Â  Â  Â  Â  document.getElementById('shop-name-hidden').style.background = 'transparent';Â 
Â  Â  Â  Â  Â  Â  document.getElementById('shop-name-hidden').innerText = 'Wildberries API';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ĞĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµĞ¼ Ğ±Ğ»Ğ¾Ğº ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸
Â  Â  Â  Â  Â  Â  document.getElementById('stats-section').classList.add('active');

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // ğŸ”„ URL Ğ²Ğ°ÑˆĞµĞ³Ğ¾ ÑĞµÑ€Ğ²ĞµÑ€Ğ° (Ğ·Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ Ğ½Ğ° Ğ²Ğ°Ñˆ)
Â  Â  Â  Â  Â  Â  Â  Â  const SERVER_URL = 'http://localhost:8080/api/wb-stats';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ğŸ›‘ Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ• Ğ”Ğ›Ğ¯ Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞĞ¡Ğ¢Ğ˜: ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğµ tg.initData
Â  Â  Â  Â  Â  Â  Â  Â  const initData = tg.initData; 
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  if (!initData) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Telegram.');
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(SERVER_URL, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wb_token: token,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tg_init_data: initData // ğŸ›‘ ĞŸĞ•Ğ Ğ•Ğ”ĞĞ§Ğ ĞŸĞĞ›ĞĞĞ“Ğ INIT DATA
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error('ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ°: ' + response.status);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (data.success) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateUI(data.data);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('status-text').textContent = 'ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹!');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(data.error || 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('status-text').textContent = 'ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ';
Â  Â  Â  Â  Â  Â  Â  Â  showNotification('ĞÑˆĞ¸Ğ±ĞºĞ°: ' + error.message, true);
Â  Â  Â  Â  Â  Â  Â  Â  console.error('API Error:', error);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ° Ñ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸
Â  Â  Â  Â  function updateUI(data) {
Â  Â  Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  Â  Â  const timeString = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });

Â  Â  Â  Â  Â  Â  document.getElementById('last-updated').innerText = `ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ² ${timeString}`;

Â  Â  Â  Â  Â  Â  // Ğ”Ğ¾Ñ…Ğ¾Ğ´ (Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸)
Â  Â  Â  Â  Â  Â  document.getElementById('val-income').innerText = `${formatCurrency(data.income)}`;
Â  Â  Â  Â  Â  Â  document.getElementById('pill-income').innerText = `${data.income_change >= 0 ? '+' : ''}${formatCurrency(data.income_change)}`;
Â  Â  Â  Â  Â  Â  document.getElementById('pill-income').className = `change-pill ${data.income_change >= 0 ? 'green' : 'red'}`;

Â  Â  Â  Â  Â  Â  // CTR (Click-Through Rate)
Â  Â  Â  Â  Â  Â  document.getElementById('val-ctr').innerText = `${data.ctr}%`;
Â  Â  Â  Â  Â  Â  document.getElementById('pill-ctr').innerText = `${data.ctr_change >= 0 ? '+' : ''}${data.ctr_change}%`;
Â  Â  Â  Â  Â  Â  document.getElementById('pill-ctr').className = `change-pill ${getPillColor(data.ctr_change, 0.1)}`;

Â  Â  Â  Â  Â  Â  // Ğ”Ğ Ğ  (Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸ĞºĞ° Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³Ğ° Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¹)
Â  Â  Â  Â  Â  Â  document.getElementById('val-drr').innerText = `${data.drr}%`;
Â  Â  Â  Â  Â  Â  document.getElementById('pill-drr').innerText = `${data.drr_change >= 0 ? '+' : ''}${data.drr_change}%`;
Â  Â  Â  Â  Â  Â  document.getElementById('pill-drr').className = `change-pill ${getPillColor(data.drr_change, 0.5)}`;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸
Â  Â  Â  Â  function formatCurrency(amount) {
Â  Â  Â  Â  Â  Â  return new Intl.NumberFormat('ru-RU').format(Math.round(amount)) + 'â‚½';
Â  Â  Â  Â  }

Â  Â  Â  Â  function getPillColor(change, threshold) {
Â  Â  Â  Â  Â  Â  if (change > threshold) return 'green';
Â  Â  Â  Â  Â  Â  if (change < -threshold) return 'red';
Â  Â  Â  Â  Â  Â  return 'neutral';
Â  Â  Â  Â  }

Â  Â  Â  Â  // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ¸Ñ Enter Ğ² Ğ¿Ğ¾Ğ»Ğµ Ğ²Ğ²Ğ¾Ğ´Ğ°
Â  Â  Â  Â  tokenInput.addEventListener('keypress', function(e) {
Â  Â  Â  Â  Â  Â  if (e.key === 'Enter') {
Â  Â  Â  Â  Â  Â  Â  Â  connectToWB();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
